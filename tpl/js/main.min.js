function moneyOutput(e,t){t=$(t);var i={};return i.type=$("#cash-output-popup input:visible").first().attr("name"),$("#cash-output-popup input:visible").each(function(e,t){$(t).hasClass("sb_but")||("radio"!=$(t).attr("type")?i[$(t).attr("name")]={title:$(t).attr($(t).attr("data-title")?"data-title":"placeholder"),value:$(t).val()}:$(t).is(":checked")&&(i[$(t).attr("name")]={title:$(t).attr("data-title"),value:$(t).attr("data-currency")}))}),requestForMoney(i,function(){updateMoney(playerMoney-parseFloat($("#cash-output-popup .form.f-sub:visible input[name=summ]").val())),$("#cash-output-popup").hide(),$("#report-popup").find(".txt").text(getText("MONEY_ORDER_COMPLETE")),$("#report-popup").show()},function(e){alert(e.message)},function(){}),!1}function moneyExchange(){var e={};return e.type="points",e.summ={title:"summ",value:$("#summ_exchange").val()},requestForMoney(e,function(){updateMoney(playerMoney-parseFloat($("#cash-exchange-popup input[name=summ]").val())),updatePoints(parseInt(playerPoints)+parseInt($("#cash-exchange-popup #points").html())),$("#cash-exchange-popup input[name=summ]").val(""),$("#cash-exchange-popup #points").html(""),$("#exchange-submit").prop("disabled",!0).addClass("button-disabled").hide(),$("#exchange-input").hide(),$("#exchange-result").fadeIn(100),window.setTimeout(function(){$("#exchange-result").hide(),$("#exchange-input").fadeIn(200),$("#exchange-submit").fadeIn(200)},2400)},function(e){alert(e.message)},function(){}),!1}function showGameProccessPopup(){filledTicketsCount>0?($(".popup").hide(),$("#game-won").hide(),$("#game-end").hide(),$("#mchance").hide(),$("#game-process").show(),$("#game-itself").show(),proccessResult()):location.reload()}function showFailPopup(e){$("#game-process").hide(),$("#game-end").show();for(var t="",i=0;5>i;++i){t+='<li class="yr-tt"><div class="yr-tt-tn">Билет #'+(i+1)+'</div><ul data-ticket="'+i+'" class="yr-tt-tr">',e.tickets[i]?$(e.tickets[i]).each(function(e,i){t+='<li class="yr-tt-tr_li" data-num="'+i+'">'+i+"</li>"}):t+="<li class='null'>Не заполнен</li>",t+="</ul></li>"}$("#game-end").find(".yr-tb").html(t);var n="";return $(e.c).each(function(e,t){n+='<li class="g-oc_li"><span class="g-oc_span">'+t+"</span></li>"}),void $("#game-end").find(".g-oc-b").html(n);var t,i,n}function showWinPopup(e){$("#game-process").hide(),$("#game-won").show();var t=[];$(".win-tbl .c-r .c-r_li").each(function(e){t[e]=$(this).find(".tb-t").html()}),t.reverse();for(var i="",n=0,a=0,s=0;5>s;++s){var o=0;i+='<li class="yr-tt"><div class="yr-tt-tn">Билет #'+(s+1)+'</div><ul data-ticket="'+s+'" class="yr-tt-tr">',e.tickets[s]?$(e.tickets[s]).each(function(t,n){i+='<li class="yr-tt-tr_li'+($.inArray(parseInt(n),e.c)>=0?" won":"")+'" data-num="'+n+'">'+n+"</li>"}):i+="<li class='null'>Не заполнен</li>",i+="</ul>";var r=[];(o=$(i).find('ul[data-ticket="'+s+'"] li.won').length)&&(i+='<div class="yr-tt-tc">'+t[o-1]+"</div>",r=t[o-1].split(" "),r[1]==getCurrency()?n+=parseFloat(r[0]):a+=parseInt(r[0])),i+="</li>"}$("#game-won").find(".yr-tb").html(i);var l="";return $(e.c).each(function(e,t){l+='<li class="g-oc_li"><span class="g-oc_span">'+t+"</span></li>"}),$("#game-won").find(".g-oc-b").html(l),$("#game-won").find(".plPointHolder").text(a),$("#game-won").find(".plMoneyHolder").text(Math.round(100*n)/100),!1;var i,s,l}function proccessResult(){getLotteryData(function(e){$("#game-process .g-oc-b .goc_li-nb").removeClass("goc-nb-act");var t=[];$(".tb-slide").length>0?$(".tb-slide").each(function(e,i){var n=[];$(i).find(".loto-tl_li.select").each(function(e,t){n.push($(t).text())}),6==n.length&&t.push(n)}):$(".yr-tb").length>0&&$(".yr-tb .yr-tt .yr-tt-tr").each(function(e,i){var n=[];$(i).find(".yr-tt-tr_li").each(function(e,t){parseInt($(t).text())>0&&n.push($(t).text())}),6==n.length&&t.push(n)}),t.length?e.tickets=t:$("#game-itself").hide();for(var i="",n=0;5>n;++n)i+='<li class="yr-tt"><div class="yr-tt-tn">Билет #'+(n+1)+'</div><ul class="yr-tt-tr">',t[n]?$(t[n]).each(function(e,t){i+='<li class="yr-tt-tr_li" data-num="'+t+'">'+t+"</li>"}):i+="<li class='null'>Не заполнен</li>",i+="</ul></li>";if($("#game-process").find(".yr-tb").html(i),e.i==parseInt($("._section.profile-history .ht-bk .lot-container").first().data("lotid"))+1){var a,s="",o=$(e.c).get(),r=function(){s=o.shift();var t=$("#game-process .g-oc_span.unfilled:first");t.text(s);var i=t.parents(".g-oc_li");i.find(".goc_li-nb").addClass("goc-nb-act"),t.removeClass("unfilled"),window.setTimeout(function(){$("#game-process").find('li[data-num="'+s+'"]').addClass("won")},1e3),o.length||(window.clearInterval(a),window.setTimeout(function(){$("#game-process").find("li.won").length?showWinPopup(e):showFailPopup(e)},2e3))};window.setTimeout(function(){r(),a=window.setInterval(r,5e3)},2e3)}else e&&e.i!=parseInt($("._section.profile-history .ht-bk .lot-container").first().data("lotid"))?location.reload():window.setTimeout(proccessResult,1e3*(Math.floor(5*Math.random())+1))},function(){window.setTimeout(proccessResult,1e3*(Math.floor(5*Math.random())+1))},function(){window.setTimeout(proccessResult,1e3*(Math.floor(5*Math.random())+1))})}function buildQuickGame(e){quickGame=e.res;var t=$("#"+quickGame.Key+"-holder");t.show().find(".qg-msg").hide().find(".td").children().hide(),$(".qg-tbl",t).removeClass("wait");var i="";for(y1=1;y1<=quickGame.Field.y;y1++)for(x1=1;x1<=quickGame.Field.x;x1++)i+="<li data-cell='"+x1+"x"+y1+"' style='width: "+quickGame.Field.w+"px;height: "+quickGame.Field.h+"px;margin: 0 "+(x1!=quickGame.Field.x?quickGame.Field.r:0)+"px "+(y1!=quickGame.Field.y?quickGame.Field.b:0)+"px 0;'></li>";width=(parseInt(quickGame.Field.w)+parseInt(quickGame.Field.r))*parseInt(quickGame.Field.x)-parseInt(quickGame.Field.r),quickGame.Field.p=quickGame.Field.p||0,$(".qg-bk-tl",t).html(quickGame.Title),$(".qg-txt",t).html(quickGame.Description),$(".qg-tbl",t).css("width",width).html(i).parents("section.pop-box").css("width",width+80),$(".qg-bk-pr",t).html(quickGame.Field.p),$(".qg-msg .bt",t).html(getText("PLAY_ONE_MORE_TIME").format(quickGame.Field.p)).attr("data-game",quickGame.Id).attr("data-key",quickGame.Key),quickGame.Timeout&&window.setTimeout(function(){location.reload()},quickGame.Timeout>0?1e3*quickGame.Timeout:1),playAudio(quickGame.Audio.start),quickGame.GameField&&$.each(quickGame.GameField,function(e,i){var n=$('.qg-tbl li[data-cell="'+e+'"]',t);i?n.addClass("m "+i.t).html(genQuickGamePrize(i)):n.addClass("m los")}),quickGame.Prizes&&($(".qg-prz",t).html(""),$.each(quickGame.Prizes,function(e,i){$(".qg-prz",t).append(previewQuickGamePrize(i))})),activateQuickGame(quickGame.Key),e.res.block&&t.find(".block").show().html('<div class="tl">Реклама</div>'+e.res.block)}function activateQuickGame(e){e=e||"QuickGame";var t=$("#"+e+"-holder");$("li[data-cell]",t).off("click").on("click",function(){var i=$(this);return quickGame.Field.c<1?(console.log("MOVES_IS_OUT"),!1):i.hasClasses("w, m")?(console.log("CELL_IS_PLAYED"),!1):i.parent().hasClass("wait")?(console.log("WAITING_FOR_SERVER"),!1):(i.addClass("w").parent().addClass("wait"),window.setTimeout(function(){i.removeClass("w"),i.parent().removeClass("wait")},5e3),void playQuickGame(e,$(this).data("cell"),function(e){var n=e.res;if(n.error)return void i.html("");playAudio(quickGame.Audio.move),quickGame.Field.c=n.Moves,i.parents("ul").removeClass("wait");var a="los",s="";n.Prize?(playAudio(quickGame.Audio.hit),t.find(".prize-holder."+n.Prize.t+'-holder:not(.w):contains("'+n.Prize.v+'")').first().addClass("w"),a=n.Prize.t,s=genQuickGamePrize(n.Prize)):playAudio(quickGame.Audio.miss),quickGame.Field.e=quickGame.Field.e||"clip",quickGame.Field.s=quickGame.Field.s||300;var o="scale"===quickGame.Field.e?{percent:0}:"size"===quickGame.Field.e?{to:{width:0,height:0}}:{};i.html($("<div></div>").css("background",i.css("background")).css("height","100%")).addClass("m "+a).find("div").effect(quickGame.Field.e,o,quickGame.Field.s,function(){this.remove(),i.html(s)}),n.GameField&&window.setTimeout(function(){$.each(n.GameField,function(e,i){var n=$('.qg-tbl li[data-cell="'+e+'"]',t);!n.html()&&i&&n.addClass("blink "+i.t).html(genQuickGamePrize(i))}),t.find("li.blink").css("opacity",.5);var e=t.find("li.blink").length?2:0,i=window.setInterval(function(){return 0==e?(window.clearInterval(i),t.find(".qg-msg").css("height",t.find(".qg-tbl").css("height")).show().find(".txt").first().show().parent().find(".preloader").hide(),n.GamePrizes.MONEY||n.GamePrizes.POINT||n.GamePrizes.ITEM?(t.find(".qg-msg").addClass("win").find(".txt").html("Поздравляем с выигрышем!"+(n.GamePrizes.MONEY?"<br>"+getCurrency(n.GamePrizes.MONEY):"")+(n.GamePrizes.POINT?"<br> "+n.GamePrizes.POINT+" баллов":"")+(n.GamePrizes.ITEM?"<br>Приз: "+n.GamePrizes.ITEM:"")),n.GamePrizes.MONEY&&updateMoney(playerMoney+parseFloat(n.GamePrizes.MONEY*coefficient)),n.GamePrizes.POINT&&updatePoints(playerPoints+parseInt(n.GamePrizes.POINT)),playAudio(quickGame.Audio.win)):(t.find(".qg-msg").removeClass("win").find(".txt").text("В этот раз не повезло"),playAudio(quickGame.Audio.lose)),void(n.Price&&$(".qg-msg .bt",t).show())):(e--,void t.find("li.blink").toggleClass("prize"))},600)},600)},function(e){i.html(""),("CHEAT_GAME"==e.message||"TIME_NOT_YET"==e.message)&&$("#report-popup .cs").on("click",function(){location.reload()}),$("#report-popup").show().find(".txt").html(getText(e.message))},function(){i.html(""),alert("error")}))})}function previewQuickGamePrize(e){switch(e.t){case"item":return'<div class="'+(e.w?"w ":"")+e.t+'-holder prize-holder"><img src="/filestorage/shop/'+e.s+'"></div>';default:return'<div class="'+(e.w?"w ":"")+e.t+'-holder prize-holder"><span>'+(e.v?"money"==e.t?getCurrency(e.v,1):e.v.replaceArray(["[*]","/"],["x","÷"]):0)+("money"==e.t?"<small> "+getCurrency()+"</small>":"")+"</span></div>"}}function genQuickGamePrize(e){switch(e.t){case"hit":return"<div></div>";case"item":return'<div><img src="/filestorage/shop/'+e.s+'"></div>';default:return'<div style="margin: 0 0 -'+parseInt(quickGame.Field.h)/15+"px 0;font-size:"+parseInt(quickGame.Field.h)/("math"==e.t?1.7:2)+'px;">'+(e.v?"money"==e.t?getCurrency(e.v,1):e.v.replaceArray(["[*]","/"],["x","÷"]):0)+'</div><div style="margin-top:-'+parseInt(quickGame.Field.h)/10+"px;font-size:"+parseInt(quickGame.Field.h)/5+'px;">'+("points"==e.t?"баллов":"money"==e.t?getCurrency(e.v,2):"")+"</div>"}}function updateNotices(e){unreadNotices=e,unreadNotices>0?($("#profile-but a span.notice-unread").html(e),$("#notice-unread").html(e),$(".notice-unread").show()):$(".notice-unread").hide()}function updatePoints(e){playerPoints=parseInt(e)||playerPoints,e=playerPoints.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "),$(".plPointHolder").text(e)}function updateMoney(e){playerMoney=parseFloat(e).toFixed(2)||playerMoney,e=parseFloat(playerMoney).toFixed(2).toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "),$(".plMoneyHolder").text(e.replace(".00",""))}function hideAllGames(){$(".msg-tb.won").hide(),$(".msg-tb.los").hide(),$(".game-bk .gm-tb").hide(),$(".game-bk .rw-b .tb").hide(),$(".game-bk .play").hide(),$(".game-bk li").removeClass("won").removeClass("los"),$(".game-bk li").removeClass("true").removeClass("blink")}function activateTicket(){$(".ticket-random").off().on("click",function(e){if($(e.target).hasClass("after"))return!1;if($(this).hasClass("select"))$(this).parents(".tb-slide").find("li.select").removeClass("select");else{var t=$(this).find(".after");t.fadeIn(300),setTimeout(function(){t.fadeOut(300)},2e3),$(".ticket-favorite .after:visible").length&&$(".ticket-favorite .after").fadeOut(150),$(this).parents(".tb-slide").find("li.select").length>0&&$(this).parents(".tb-slide").find("li.select").removeClass("select"),ticketCache=[];for(var i=1;6>=i;++i)ticketCache.push(randomCachedNum());var n=$(this);$(ticketCache).each(function(e,t){n.parents(".tb-slide").find(".loto-"+t).addClass("select")}),$(this).addClass("select"),$(this).parents(".tb-slide").find(".tb-ifo b").html(0),$(this).parents(".tb-slide").find(".sm-but").addClass("on")}6-$(this).parents(".tb-slide").find(".tb-loto-tl li.select").length>0?($(this).parents(".tb-slide").find(".tb-ifo").show(),$(this).parents(".tb-slide").find(".tb-ifo b").html(6-$(this).parents(".tb-slide").find(".tb-loto-tl li.select").length),$(this).parents(".tb-slide").find(".add-ticket").removeClass("on")):($(this).parents(".tb-slide").find(".tb-ifo").hide(),$(this).parents(".tb-slide").find(".add-ticket").addClass("on"))}),$(".ticket-favorite").off().on("click",function(){if($(this).hasClass("select"))$(this).parents(".tb-slide").find("li.select").removeClass("select");else if($(".ticket-random .after:visible").length&&$(".ticket-random .after").fadeOut(150),$(this).parents(".tb-slide").find("li.select").length>0&&$(this).parents(".tb-slide").find("li.select").removeClass("select"),playerFavorite.length){for(var e=0;5>=e;++e)$(this).parents(".tb-slide").find(".loto-"+playerFavorite[e]).addClass("select");$(this).addClass("select"),$(this).parents(".tb-slide").find(".tb-ifo b").html(0),$(this).parents(".tb-slide").find(".sm-but").addClass("on")}else $(this).find(".after:hidden").length?$(this).find(".after").fadeIn(200):$(this).find(".after").fadeOut(200);6-$(this).parents(".tb-slide").find(".tb-loto-tl li.select").length>0?($(this).parents(".tb-slide").find(".tb-ifo").show(),$(this).parents(".tb-slide").find(".tb-ifo b").html(6-$(this).parents(".tb-slide").find(".tb-loto-tl li.select").length),$(this).parents(".tb-slide").find(".add-ticket").removeClass("on")):($(this).parents(".tb-slide").find(".tb-ifo").hide(),$(this).parents(".tb-slide").find(".add-ticket").addClass("on"))}),$(".ticket-favorite .after i").off().on("click",function(){$('.profile .ul_li[data-link="profile-info"]').click()}),$(".tb-loto-tl li.loto-tl_li").off().on("click",function(){if($(".ticket-favorite .after:visible").fadeOut(300),!$('.tb-tabs_li[data-ticket="'+$(this).parents(".tb-slide").data("ticket")+'"]').hasClass("done")&&(6!=$(this).parents(".tb-slide").find(".tb-loto-tl li.select").length||$(this).hasClass("select")))if($(this).hasClass("ticket-random")||$(this).hasClass("ticket-favorite")){var e=$(this).closest("ul").find(".select").length,t=6-e+1;$(this).removeClass("select"),$(this).closest(".tb-slide").find(".tb-ifo b").html(t),$(this).closest(".tb-slide").find(".tb-ifo").show(),$(this).closest(".tb-slide").find(".sm-but").removeClass("on")}else if($(this).hasClass("select")){var e=$(this).closest("ul").find(".select").length,t=6-e+1;$(this).removeClass("select"),$(this).closest(".tb-slide").find(".tb-ifo b").html(t),$(this).closest(".tb-slide").find(".tb-ifo").show(),$(this).closest(".tb-slide").find(".sm-but").removeClass("on")}else{var e=$(this).closest("ul").find(".select").length,t=5-e;6>e&&($(this).addClass("select"),$(this).closest(".tb-slide").find(".tb-ifo b").html(t),5==e&&($(this).closest(".tb-slide").find(".tb-ifo").hide(),$(this).closest(".tb-slide").find(".sm-but").addClass("on")))}})}function getCurrency(e,t){var i=null;if($.inArray(t,["iso","one","few","many"])>=0){var i=t;t=null}switch(e&&""!=e&&"undefined"!=e||(e=null),e){case null:return currency.iso;case"coefficient":case"rate":return currency[e]?currency[e]:1;case"iso":case"one":case"few":case"many":return currency[e]?currency[e]:currency.iso;default:return e=round(parseFloat(e)*currency.coefficient,2),("many"==i||!i&&e>=5)&&currency.many?(t&&1!=t?"":e)+(1==t?null:(t?"":" ")+currency.many):("few"==i||!i&&(e>1||1>e))&&currency.few?(t&&1!=t?"":e)+(1==t?null:(t?"":" ")+currency.few):("one"==i||!i&&1==e)&&currency.one?(t&&1!=t?"":e)+(1==t?null:(t?"":" ")+currency.one):(t&&1!=t?"":e)+(1==t?null:(t?"":" ")+currency.iso)}}function getText(e){return texts[e]?texts[e]:e}function playAudio(e){$.cookie("audio-off")||($.isArray(e)?appAudio&&appAudio[e[0]]&&(file=appAudio[e[0]][e[1]])&&$('<audio src=""></audio>').attr("src","tpl/audio/"+file).trigger("play"):e&&$('<audio src=""></audio>').attr("src","tpl/audio/"+e).trigger("play"))}function randomCachedNum(){var e=Math.floor(49*Math.random()+1);return $(ticketCache).each(function(t,i){i==e&&(e=randomCachedNum())}),e}function moveToEnd(e){var t,i;if(document.createRange)t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),i=window.getSelection(),i.removeAllRanges(),i.addRange(t);else{var t=document.body.createTextRange();t.moveToElementText(e),t.collapseToEnd(),t.select()}}function echo(e){var t=new Date;console.log(t.toLocaleTimeString()+": "+e)}var currentShowedItem=0,winChance=!1,filledTicketsCount=0;jQuery.fn.random=function(){var e=Math.floor(Math.random()*this.length);return jQuery(this[e])},$(function(){function e(){currentShowedItem=$(this).data("itemId"),$("#shop-items-popup").find(".item-preview").attr("src",$(this).find(".im-ph img").attr("src")),$("#shop-items-popup").find(".item-title").text($(this).find(".im-tl").text()),$("#shop-items-popup").find(".item-price").text($(this).find(".im-bn b").text()),$("#shop-items-popup").fadeIn(200),$(".pz-ifo-bk").show(),$(".pz-fm-bk").hide(),$(".pz-rt-bk").hide()}function t(){var e=$(".reviews .rv-image");if(c.image)$.ajax({url:"/review/removeImage/",method:"POST",async:!0,data:{image:c.image},dataType:"json",success:function(t){1==t.status?(e.css("background","#e1ecee").css("opacity","1"),$(".reviews .rv-upld-img img").attr("src","/tpl/img/but-upload-review.png"),c.image=null):alert(t.message)},error:function(){alert("Unexpected server error")}});else{var t=$('<form method="POST" enctype="multipart/form-data"><input type="file" name="image"/></form>'),i=t.find('input[type="file"]').damnUploader({url:"/review/uploadImage",fieldName:"image",data:c,dataType:"json"});i.off("du.add").on("du.add",function(t){t.uploadItem.completeCallback=function(t,i){e.css("background",'url("'+i.res.imageWebPath+'") no-repeat').css("opacity","0.5").css("background-size","cover"),$(".reviews .rv-upld-img img").attr("src","/tpl/img/but-delete-review.png"),c.image=i.res.imageName},t.uploadItem.progressCallback=function(e){console.log(e)},t.uploadItem.addPostData("Id",c.id),t.uploadItem.addPostData("Image",c.image),t.uploadItem.upload()}),t.find('input[type="file"]').click()}}function i(e){e.res.offset>0&&($(".mr-cl-bt-bl").show(),e.res.keepButtonShow?$(".mr-cl-bt-bl").find(".mr").show():$(".mr-cl-bt-bl").find(".mr").hide());var t="";if(e.res.lotteries){for(var i in e.res.lotteries){var n=e.res.lotteries[i];t+='<li class="lot-container'+(u||n.iPlayed?" win":"")+'"><div class="dt">'+n.date+'</div><ul class="ht-ct">',$(n.combination).each(function(e,i){t+="<li>"+i+"</li>"}),t+='</ul><div class="nw">'+n.winnersCount+"</div>",(n.winnersCount>0||n.iPlayed||u)&&(t+='<div class="aw-bt" data-lotid="'+n.id+'"><a href="javascript:void(0)"></a></div>'),t+="</li>"}$(".profile-history").find(".ht-bk").append(t),$(".profile-history .ht-bk .aw-bt").off("click").on("click",s)}}function n(){loadLotteryDetails($("#profile-history").data("lotid"),"next",function(e){r(e)},function(){$("#profile-history").hide()},function(){})}function a(){loadLotteryDetails($("#profile-history").data("lotid"),"prev",function(e){r(e)},function(){$("#profile-history").hide()},function(){})}function s(){loadLotteryDetails($(this).data("lotid"),"current",function(e){r(e)},function(){$("#profile-history").hide()},function(){})}function r(e){$("#profile-history").data("lotid",e.res.lottery.id),$("#profile-history").find(".ws-dt").text(e.res.lottery.date);var t=winnerHtml="";$(e.res.lottery.combination).each(function(e,i){t+='<li class="yr-tt-tr_li">'+i+"</li>"}),$("#profile-history").find(".loto-holder").html(t);var i="";if($(e.res.winners).each(function(e,t){t.you&&(i=t.id),winnerHtml+='<li data-id="'+t.id+'" '+(t.you?'class="you"':"")+'><div class="tl"><div class="ph" data-img="'+(t.avatar?t.avatar:"/tpl/img/default.jpg")+'" style="background-image:url('+(t.avatar?t.avatar:"/tpl/img/default.jpg")+')"></div><div class="nm">'+(t.name&&t.surname?t.name+" "+t.surname:t.nick)+"</div></div></li>"}),i=playerId,winnerHtml?$("#profile-history").find(".ws-lt").html(winnerHtml).show():$("#profile-history").find(".ws-lt").hide(),e.res.tickets[i]){$("#profile-history").find(".ws-yr-tks-bk").show();for(var s=e.res.tickets[i],o="",r=1;5>=r;++r)o+='<li class="yr-tt">',o+='<div class="yr-tt-tn">Билет #'+r+'</div><ul class="yr-tt-tr">',s[r]?($(s[r].combination).each(function(e,t){o+='<li class="yr-tt-tr_li" data-num="'+t+'">'+t+"</li>"}),o+='</ul><div class="yr-tt-tc">'+s[r].win+"</div>"):o+='<li class="null">не заполнен</li></ul>',o+="</li>";$("#profile-history").find(".yr-tb").html(o),$(e.res.lottery.combination).each(function(e,t){$("#profile-history").find(".yr-tb").find('li[data-num="'+t+'"]').addClass("won")})}else o='<li class="yr-tt"><div class="yr-tt-tn none">Вы не принимали участие в данном розыгрыше</div></li>',$("#profile-history").find(".yr-tb").html(o);$("#profile-history").find(".wr-pf-pr").hide(),$("#profile-history").find(".ws-lt").find("li").off("click").on("click",function(e){e.stopPropagation()}),$("#profile-history").find(".ws-lt").find("li:first").click(),$("#profile-history .ar-r").off("click").on("click",a),$("#profile-history .ar-l").off("click").on("click",n)}$(document).ready(function(){var e=window.location.hash;if(e){var t=e.split("#")[1];$(".tn-mbk li[data-href="+t+"]").click()}}),$("#hr-io-slider").slick({dots:!0,arrows:!1,autoplay:!0,autoplaySpeed:4e3}),$(".popup .cs").on("click",function(){$(".popup").fadeOut(200)}),$(document).on("click",".notifications .cs",function(){badge=$(this).parent().parent().parent(),badge.fadeOut(1200),"qgame"!=badge.attr("id")&&setTimeout(function(){badge.remove()},1200)}),$(document).on("click",".notifications .badge#notice div div:not(.cs)",function(){$("li#profile-but").click(),$('section.profile .p-cnt li[data-link="profile-notice"]').click(),$(this).prev().prev().click()}),$(".popup").click(function(e){if(!$(e.target).closest(".pop-box").length){if($(e.target).closest(".popup").find("#game-process:visible").length)return!1;if($(e.target).closest("#mchance").length)return!1;if($(e.target).closest("#QuickGame-holder").length)return!1;if($(e.target).closest("#mail-conf").length)return!1;if($(e.target).closest("#game-itself").length&&document.location.reload(),$(e.target).closest(".popup").hasClass("chance"))return!1;$(".popup").fadeOut(200)}}),$("#logout a, .profile .p-exit-bt").on("click",function(){$("#logout-popup").fadeIn(300)}),$("#logout-popup .exit").on("click",function(){document.location.href="/players/logout"}),$("#logout-popup .back").on("click",function(){$(this).closest(".popup").fadeOut(300)}),activateTicket(),$(".tb-tabs_li").on("click",function(){var e=$(this).attr("data-ticket"),t=$("#tb-slide"+e);$(this).hasClass("now")||$(".tb-slides").find("#ticket_video").length||(activateTicket(),$(".tb-tabs_li").removeClass("now").find("span").hide(),$(this).addClass("now").find("span").show(),$(".tb-slides .tb-slide").fadeOut(300),setTimeout(function(){t.fadeIn(300)},300),filledTicketsCount!=bannerTicketLastNum||$(this).hasClass("done")||$.ajax({url:"/content/banner/TicketLast",method:"POST",async:!0,dataType:"json",success:function(e){t.parent().prepend(e.res.block)},error:function(e){console.log(e.responseText)}}))});var l=[];$(".add-ticket").on("click",function(){if($(this).hasClass("on")&&!$(this).data("disabled")){$(this).data("disabled",!0);var e=[];$(this).parents(".tb-slide").find("li.select").each(function(t,i){$(i).hasClass("ticket-favorite")||$(i).hasClass("ticket-random")||e.push($(i).text())});var t=$(this),i=$(this).parents(".tb-slide").data("ticket");addTicket(i,e,function(){if(t.closest(".bm-pl").find(".tb-fs-tl").remove(),$('.tb-tabs_li[data-ticket="'+i+'"]').addClass("done"),t.closest(".tb-slide").addClass("done"),t.closest(".tb-st-bk").html('<div class="tb-st-done">подтвержден и принят к розыгрышу</div>'),$(".tb-slide.done").find(".loto-tl_li").off("click"),$(".tb-slide.done").find(".ticket-random").off("click"),$(".tb-slide.done").find(".ticket-favorite").off("click"),filledTicketsCount++,5==$(".tb-tabs .done").length){$(".tb-slide").each(function(e,t){var i=[];$(t).find("li.select").each(function(e,t){i.push($(t).text())}),l.push(i)}),$(".tb-tabs, .tb-slides").remove();var e='<ul class="yr-tb">';$(l).each(function(t,i){e+='<li class="yr-tt"><div class="yr-tt-tn">Билет #'+(t+1)+'</div><ul class="yr-tt-tr">',$(i).each(function(t,i){e+='<li class="yr-tt-tr_li">'+i+"</li>"}),e+="</ul></li>"}),e+="</ul>",$(".atd-bk").prepend($(e)),$(".atd-bk").show()}else $(".tb-tabs_li:not(.done)").first().click();$(this).data("disabled",!1)},function(e){"ALREADY_FILLED"==e.message&&(t.closest(".bm-pl").find(".tb-fs-tl").remove(),t.closest("section.tickets").find("li.now").addClass("done"),t.closest(".tb-slide").addClass("done"),t.closest(".tb-st-bk").html('<div class="tb-st-done" style="color:red">Этот билет уже был заполнен</div>')),$(this).data("disabled",!1)},function(){$(this).data("disabled",!1)})}}),$(".send-invite").on("click",function(){var e=$(this).parent().find('input[name="email"]').val(),t=$(this);addEmailInvite(e,function(e){t.parent().find(".it-msg-bk").remove(),t.parents(".if-bk").find(".invites-count").text(e.res.invitesCount),t.parent().find('input[name="email"]').hide(),t.parent().find(".inp-bk").append('<span class="it-msg-bk'+(0==e.status?" error":"")+'">Приглашение отправлено</span>'),setTimeout(function(){t.parent().find(".it-msg-bk").fadeOut(300),t.parent().find('input[name="email"]').val(""),setTimeout(function(){t.parent().find(".it-msg-bk").remove(),t.parent().find('input[name="email"]').fadeIn(300)},300)},3e3)},function(e){t.parent().find(".it-msg-bk").remove(),t.parent().find('input[name="email"]').hide(),t.parent().find(".inp-bk").append('<span class="it-msg-bk'+(0==e.status?" error":"")+'">'+e.message+"</span>"),setTimeout(function(){t.parent().find(".it-msg-bk").fadeOut(300),setTimeout(function(){t.parent().find(".it-msg-bk").remove(),t.parent().find('input[name="email"]').fadeIn(300)},300)},3e3)},function(){})}),$(".prizes .pz-more-bt, .prizes .mr-cl-bt-bk .mr").on("click",function(){var t=$(this);loadShop($(".shop-category.now").data("id"),$(".shop-category-items:visible .pz-cg_li").length,function(i){if(i.res.items.length){var n="";$(i.res.items).each(function(e,t){n+='<li class="pz-cg_li'+(t.quantity&&0==t.quantity?" pz-end":"")+'" data-item-id="'+t.id+'">',t.quantity>0?n+=$(".tpl.pz-lim-tpl").clone().find("b").prepend(t.quantity+" ").parents(".tpl").html():t.quantity&&0==t.quantity&&(n+=$(".tpl.pz-end-tpl").html()),n+='<div class="im-ph"><img src="/filestorage/shop/'+t.img+'"></div><div class="im-tl">'+t.title+'</div><div class="im-bn"><b>'+t.price+"</b><span>обменять на баллов</span></div></li>"}),$(".shop-category-items:visible").append(n),$(".shop-category-items li:not(.pz-end)").off("click").on("click",e)}t.hasClass("pz-more-bt")&&t.hide(),$(".prizes .mr-cl-bt-bk").show(),i.res.keepButtonShow?$(".mr-cl-bt-bk .mr").show():($(".mr-cl-bt-bk .mr").hide(),$(".pz-more-bt").hide())},function(){},function(){})}),$(".prizes .mr-cl-bt-bk .cl").on("click",function(){$(".shop-category-items:visible").find(".pz-cg_li").each(function(e,t){e>=6&&$(t).remove()}),$(this).closest(".mr-cl-bt-bk").hide(),$(".prizes .pz-more-bt").show()}),$(".shop-category").on("click",function(){$(".shop-category").removeClass("now"),$(this).addClass("now");var e=$(this);$(".mr-cl-bt-bk").hide(),$(".shop-category-items").hide(),$('.shop-category-items[data-category="'+$(e).data("id")+'"]').show(),$('.shop-category-items[data-category="'+$(e).data("id")+'"]').find(".pz-cg_li").length<6?$(".prizes .pz-more-bt").hide():($(".prizes .pz-more-bt").show(),$('.shop-category-items[data-category="'+$(e).data("id")+'"]').find(".pz-cg_li").each(function(e,t){e>=6&&$(t).remove()}))}),$(".shop-category-items li:not(.pz-end)").on("click",e),$(".pz-ifo-bk .pz-ifo-bt").on("click",function(){var e=parseInt($("#shop-items-popup").find(".item-price").text().replace(/\s*/g,""));e>playerPoints?($(".pz-ifo-bk").hide(),$(".pz-rt-bk").text(getText("INSUFFICIENT_FUNDS")).show()):($(".pz-ifo-bk").hide(),$(".pz-fm-bk").show())}),$(".pz-fm-bk .pz-ifo-bt").on("click",function(){form=$(this).parent().find(".fm-inps-bk"),form.find(".pi-inp-bk").removeClass("error");var e={itemId:currentShowedItem,chanceWin:winChance?1:0,name:form.find('input[name="name"]').val(),surname:form.find('input[name="surname"]').val(),phone:form.find('input[name="phone"]').val(),region:form.find('input[name="region"]').val(),city:form.find('input[name="city"]').val(),addr:form.find('input[name="addr"]').val()};createItemOrder(e,function(){$(".pz-fm-bk").hide();var e=$(".pz-rt-bk").data("default");$("#shop-items-popup").hasClass("chance")&&$(".game-bk .bk-bt").click(),$(".pz-rt-bk").text(e).show()},function(e){switch("INSUFFICIENT_FUNDS"==e.message&&($(".pz-fm-bk").hide(),$(".pz-rt-bk").text(getText(e.message)).show()),e.message){case"ORDER_INVALID_NAME":form.find('input[name="name"]').parent().addClass("error"),form.find('input[name="name"]').focus();break;case"ORDER_INVALID_SURNAME":form.find('input[name="surname"]').parent().addClass("error"),form.find('input[name="surname"]').focus();break;case"ORDER_INVALID_PHONE":case"INVALID_PHONE_FORMAT":form.find('input[name="phone"]').parent().addClass("error"),form.find('input[name="phone"]').focus();break;case"ORDER_INVALID_CITY":form.find('input[name="city"]').parent().addClass("error"),form.find('input[name="city"]').focus();break;case"ORDER_INVALID_ADRESS":form.find('input[name="addr"]').parent().addClass("error"),form.find('input[name="addr"]').focus()}},function(){})}),$(".reviews .rv-upld-img").on("click",t);var c={image:"",text:"",id:0},d={image:"",text:"",id:0,reviewId:null};$(".reviews .rv-but-add").on("click",function(){c.text=$(".reviews .rv-txt .textarea").text(),c.text&&!$(this).data("disabled")&&($(this).data("disabled",!0),$.ajax({url:"/review/save/",method:"POST",async:!0,data:c,dataType:"json",success:function(e){1==e.status?(c.image=null,$(".reviews .rv-form").hide(),$(".reviews .rv-txt .textarea").html(""),$(".reviews .rv-image").css("background","#e1ecee").css("opacity","1"),$(".reviews .rv-upld-img img").attr("src","/tpl/img/but-upload-review.png"),$(".rv-sc").fadeIn(200),window.setTimeout(function(){$(".rv-sc").hide(),$(".reviews .rv-form").fadeIn(200)},2400),$(this).data("disabled",!1)):($(this).data("disabled",!1),alert(e.message))},error:function(){alert("Unexpected server error")}}))}),$(document).on("click",".reviews .rv-ans .btn-ans",function(){holder=$(this).parents(".rv-ans").first(),d.text=$("#answer-review-text").text(),d.text&&!$(this).attr("data-disabled")&&($(this).attr("data-disabled",!0),$.ajax({url:"/review/save/",method:"POST",async:!0,data:d,dataType:"json",success:function(e){1==e.status?(d.image=null,$(".rv-form",holder).hide(),$(".rv-image",holder).css("background","#e1ecee").css("opacity","1"),$(".rv-upld-img img",holder).attr("src","/tpl/img/but-upload-review.png"),$(".rv-sc",holder).fadeIn(200),window.setTimeout(function(){holder.fadeOut(200),window.setTimeout(function(){holder.remove()},200)},2400)):($(this).data("disabled",!1),alert(e.message))},error:function(){alert("Unexpected server error")}}))}),$(document).on("click",".rv-i-ans",function(){var e=$(this).parents(".rv-item").first(),t=$(getTpl.comments.answer());d.reviewId=e.attr("data-id"),$(".rv-ans").remove(),$(".rv-usr-avtr").clone().prependTo($(".rv-form",t)),t.attr("class",e.attr("class")).removeClass("rv-item").addClass("rv-ans rv-answer"),t.find("[contenteditable]").attr("id","answer-review-text").html(e.find(".rv-i-pl").text()+",&nbsp;"),t.insertAfter(e),moveToEnd(document.getElementById("answer-review-text"))}),$(".rv-add-but, .rv-mr-cl-bt-bk .mr").on("click",function(){if($(this).hasClass("dis"))return!1;var e=$(this);e.addClass("dis");var t=$(".reviews");loadReviews(t.find(".rv-item:not(.rv-answer)").length,function(i){t.addClass("b-ha"),e.removeClass("dis"),$(".rv-add-but").hide(),appendReviews(i.res.reviews),i.res.keepButtonShow||$(".rv-mr-cl-bt-bk .mr").hide(),t.find(".rv-mr-cl-bt-bk").show(),$(".rv-items").height($(".rv-items .h-ch").height())
},function(){e.removeClass("dis")},function(){e.removeClass("dis")})}),$(".reviews .rv-mr-cl-bt-bk .cl").on("click",function(){var e=$(".reviews");$(".rv-items").find(".rv-item").each(function(e,t){e>=6&&$(t).remove()}),$(".rv-items").removeAttr("style"),$(".rv-mr-cl-bt-bk .mr").show(),$(this).closest(".rv-mr-cl-bt-bk").hide(),$(".rv-add-but").show(),e.removeClass("b-ha")}),$(".news .n-add-but, .n-mr-cl-bt-bk .mr").on("click",function(){var e=$(".news");loadNews(e.find(".n-item").length,function(t){if(t.res.news.length){e.addClass("b-ha");var i="";$(t.res.news).each(function(e,t){i+='<div class="n-item"><div class="n-i-tl">'+t.title+" • "+t.date+'</div><div class="n-i-txt">'+t.text+"</div></div>"}),$(".n-items .h-ch").append(i),$(".n-items").height($(".n-items .h-ch").height()),$(".n-add-but").hide(),t.res.keepButtonShow||$(".n-mr-cl-bt-bk .mr").hide(),e.find(".n-mr-cl-bt-bk").show()}},function(){},function(){})}),$(".news .n-mr-cl-bt-bk .cl").on("click",function(){var e=$(".news");$(".n-items").find(".n-item").each(function(e,t){e>=6&&$(t).remove()}),$(".n-items").removeAttr("style"),$(".n-mr-cl-bt-bk .mr").show(),$(this).closest(".n-mr-cl-bt-bk").hide(),$(".n-add-but").show(),e.removeClass("b-ha")}),$(".r-add-but").on("click",function(){var e=$(".rules");e.hasClass("b-ha")?($(".rules .faq").hide(),$(".r-add-but.more").show(),$(".r-add-but.less").hide(),e.removeClass("b-ha")):(e.addClass("b-ha"),$(".rules .faq").show(),$(".r-add-but.more").hide(),$(".r-add-but.less").show())}),$("#cash-output").on("click",function(){playerMoney>=10?($("#cash-output-popup").fadeIn(200),$(".csh-ch-bk .form").hide(),$('#cash-output-popup input[name="cash"]').prop("checked",!1)):($(".pz-ifo-bk").hide(),$(".pz-rt-bk").text(getText("INSUFFICIENT_FUNDS")).show().parents("#shop-items-popup").show())}),$("#cash-exchange").on("click",function(){playerMoney>0?($("#exchange-submit").prop("disabled",!0).addClass("button-disabled"),$("#summ_exchange").val(""),$("#points").html(""),$("#cash-exchange-popup").fadeIn(200),$("#cash-exchange-popup div.form").show(),$("#cash-exchange-popup input").focus()):($("#report-popup").find(".txt").text(getText("INSUFFICIENT_FUNDS")),$("#report-popup").show())}),$(".pi-cs-bk .cs-int-bt.int").on("click",function(){btn=$(this),provider=btn.data("provider"),btn.hasClass("int")&&$.ajax({url:"/players/disableSocial/"+provider,method:"GET",async:!0,data:null,dataType:"json",success:function(e){1==e.status?(btn.removeClass("int"),btn.wrapAll('<a href="./auth/'+provider+'?method=link"></a>')):alert(e.message)},error:function(){alert("Unexpected server error")}})}),$(".profile aside li").on("click",function(){var e=$(this).attr("data-link");$(".profile aside li").removeClass("now"),$(this).addClass("now"),$(".profile ._section").hide(),$("."+e).fadeIn(200),"profile-info"==e&&$(".pi-inp-bk input").each(function(){$(this).val($(this).attr("data-valid"))})}),$(".pi-inp-bk input").on("focus",function(){$(this).closest(".pi-inp-bk").addClass("focus"),"date"==$(this).attr("name")&&$(this).attr("type","date"),$(".profile-info .save-bk .sb-ch-td .but").addClass("save")}),$(".pi-inp-bk input").on("blur",function(){$(this).closest(".pi-inp-bk").removeClass("focus"),"date"==$(this).attr("name")&&$(this).attr("type","text")}),$("section.profile .p-bk").on("click",function(e){$(e.target).closest(".fc-nrch-bk").length||$(e.target).closest(".fc-nbs-bk").length||($(".fc-nbs-bk").fadeOut(200),$(".fc-nrch-bk li").removeClass("on"))}),$(".profile-info #rulcheck").on("change",function(){$(".profile-info .but").addClass("save")}),$(".fc-nrch-bk li").on("click",function(){if($(".profile-info .but").addClass("save"),$(this).hasClass("on"))$(this).removeClass("on"),$(".fc-nbs-bk").fadeOut(200);else{$(".fc-nrch-bk li").removeClass("on");var e=$(this).find("span").text();$(".fc-nbs-bk li.dis").each(function(){$(this).text()==e&&$(this).removeClass("dis")}),$(this).find("span").text(""),$(this).addClass("on"),$(".fc-nbs-bk").fadeIn(200)}}),$(".fc-nbs-bk li").on("click",function(){if(!$(this).hasClass("dis")){var e=$(this).text();$(".fc-nrch-bk li.on span").text(e),$(this).addClass("dis"),$(".fc-nbs-bk").fadeOut(200),$(".fc-nrch-bk li.on").removeClass("on")}}),$(".multilanguage").on("input",function(){var e=$(this);changeLanguage(e.val(),function(){location.reload()},function(e){$("#report-popup").find(".txt").text(getText(e.message)),$("#report-popup").show()},function(){alert("error")})}),$.extend($.inputmask.defaults,{definitions:{9:{validator:"[0-9]",cardinality:1,definitionSymbol:"*"},a:{validator:"[RrUuZzEeBb]",cardinality:1,casing:"upper"},d:{validator:"0[1-9]|[12][0-9]|3[01]",cardinality:2,prevalidator:[{validator:"[0-3]",cardinality:1}]},m:{validator:"0[1-9]|1[012]",cardinality:2,prevalidator:[{validator:"[01]",cardinality:1}]},y:{validator:"(19|20)\\d{2}",cardinality:4,prevalidator:[{validator:"[12]",cardinality:1},{validator:"(19|20)",cardinality:2},{validator:"(19|20)\\d",cardinality:3}]}},onincomplete:function(){$(this).val()&&$(this).parent().addClass("incomplete error").removeClass("complete")},oncomplete:function(){$(this).parent().removeClass("incomplete error").addClass("complete")},oncleared:function(){$(this).parent().removeClass("incomplete error complete")},autoUnmask:!0,showMaskOnHover:!1});var p=$.masksSort($.masksLoad(),["#"],/[0-9]|#/,"mask"),f={inputmask:{definitions:{"#":{validator:"[0-9]",cardinality:1}}},match:/[0-9]/,replace:"#",list:p,listKey:"mask"};$('[type="tel"][name="phone"]').inputmasks(f),$('[type="tel"][name="qiwi"]').inputmasks(f),$('[type="text"][name="bd"]').inputmask("d.m.y",{autoUnmask:!1}),$('[type="text"][name="yandex"]').inputmask("Regex",{regex:"41001[0-9]{7,10}$"}),$('[type="text"][name="webmoney"]').inputmask("Regex",{regex:"[RZBUE][0-9]{12}$"}),$(".ph-fr-bk li").on("click",function(){$(this).closest("ul.ph-fr-bk").find("li").removeClass("sel"),$(this).addClass("sel")});var u=!1;if($(".ph-fr-bk .bt-om").on("click",function(){u=!0,$(this).parents(".profile-history").find(".ht-bk").find("li.lot-container").remove(),loadLotteries(0,u,i,function(){},function(){})}),$(".ph-fr-bk .bt-all").on("click",function(){u=!1,$(this).parents(".profile-history").find(".ht-bk").find("li.lot-container").remove(),loadLotteries(0,u,i,function(){},function(){})}),$(".profile-history .mr-bt, .profile-history .mr").on("click",function(){var e=$(this);e.hide();var t=e.parents(".profile-history").find(".ht-bk").find("li.lot-container").length;loadLotteries(t,u,i,function(){},function(){})}),$(".profile-history .cl").on("click",function(){var e=0;$(this).parents(".profile-history").find(".ht-bk").find("li.lot-container").each(function(t,i){6>e?e++:$(i).remove()}),$(".mr-bt").show(),$(".mr-cl-bt-bl").find(".mr").show(),$(".mr-cl-bt-bl").hide()}),$('form[name="profile"]').on("submit",function(){var e=$(this),t={};return $(".incomplete",e).length?!1:(e.find(".pi-inp-bk input").each(function(){var e=$(this).val();$(this).attr("data-valid",e)}),e.find(".save").removeClass("save"),e.find(".pi-inp-bk").removeClass("error"),e.find(".ph").each(function(e,t){$(t).text($(t).data("default"))}),e.find("input").each(function(e,i){"plug"!=$(i).attr("name")&&(t[$(i).attr("name")]=$(i).val())}),t.email=$("#profile_email").text(),t.favs=[],playerFavorite=[],$(".fc-nbs-bk").find("li.dis").each(function(e,i){playerFavorite.push($(i).text()),t.favs.push($(i).text())}),t.visible=e.find('input[name="visible"]:checked').length?1:0,updatePlayerProfile(t,function(){$('input[name="password"]',e).val(""),$(".complete input",e).attr("disabled","disabled")},function(t){switch(t.message){case"NICKNAME_BUSY":e.find('input[name="nick"]').parent().addClass("error"),e.find('input[name="nick"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_PHONE_FORMAT":e.find('input[name="phone"]').parent().addClass("error"),e.find('input[name="phone"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_DATE_FORMAT":e.find('input[name="bd"]').parent().addClass("error"),e.find('input[name="bd"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_PHONE_FORMAT":case"PHONE_BUSY":e.find('input[name="phone"]').parent().addClass("error"),e.find('input[name="phone"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_QIWI_FORMAT":case"QIWI_BUSY":e.find('input[name="qiwi"]').parent().addClass("error"),e.find('input[name="qiwi"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_WEBMONEY_FORMAT":case"WEBMONEY_BUSY":e.find('input[name="webmoney"]').parent().addClass("error"),e.find('input[name="webmoney"]').parent().find(".ph").text(getText(t.message));break;case"INVALID_YANDEXMONEY_FORMAT":case"YANDEXMONEY_BUSY":e.find('input[name="yandex"]').parent().addClass("error"),e.find('input[name="yandex"]').parent().find(".ph").text(getText(t.message));break;default:$("#report-popup").find(".txt").text(getText(t.message)),$("#report-popup").show()}},function(e){$("#report-popup").find(".txt").text(getText(e.message)),$("#report-popup").show()}),!1)}),$('form[name="profile"]').find(".pi-ph.true i").off("click").on("click",function(e){e.stopPropagation(),removePlayerAvatar(function(){$('form[name="profile"]').find(".pi-ph").find("img").remove(),$('form[name="profile"]').find(".pi-ph").removeClass("true")},function(){},function(){})}),$('form[name="profile"]').find(".pi-ph").on("click",function(){var e=$('<form method="POST" enctype="multipart/form-data"><input type="file" name="image"/></form>'),t=e.find('input[type="file"]').damnUploader({url:"/players/updateAvatar",fieldName:"image",dataType:"json"}),i=$("<img></img>"),n=$(this);n.find("img").length&&(i=n.find("img")),t.off("du.add").on("du.add",function(e){e.uploadItem.completeCallback=function(e,t){i.attr("src",t.res.imageWebPath),n.addClass("true"),n.append(i),$('form[name="profile"]').find(".pi-ph.true i").off("click").on("click",function(e){e.stopPropagation(),removePlayerAvatar(function(){$('form[name="profile"]').find(".pi-ph").find("img").remove(),$('form[name="profile"]').find(".pi-ph").removeClass("true")},function(){},function(){})})},e.uploadItem.progressCallback=function(){},e.uploadItem.upload()}),e.find('input[type="file"]').click()}),$(".profile-history .ht-bk .aw-bt").on("click",s),$("#cash-exchange-popup input").on("keyup",function(){var e;$(this).val($(this).val().replaceArray(["ю","Ю"],".")),(new_input=$(this).val().match(/\d*[,.]\d{2}/))&&$(this).val(new_input),input_money=parseFloat($(this).val()),!is_numeric($(this).val())&&$(this).val()&&e>0&&$(this).val(e),input_money>playerMoney&&$(this).val()&&(input_money=playerMoney,$(this).val(playerMoney)),$("#cash-exchange-popup #points").html(parseInt(input_money*$("#cash-exchange-popup #rate").html())),parseInt($("#cash-exchange-popup #points").html())>0?$("#exchange-submit").prop("disabled",!1).removeClass("button-disabled"):$("#exchange-submit").prop("disabled",!0).addClass("button-disabled"),e=$(this).val()}),$(".csh-ch-bk .m_input").on("focus",function(){$(this).parent().addClass("focus")}),$(".csh-ch-bk .m_input").on("blur",function(){$(this).parent().removeClass("focus")}),$(".csh-ch-bk .f_input").hover(function(){$(".inp-fl-bt").hasClass("check")||$(".inp-fl-bt").addClass("hover")},function(){$(".inp-fl-bt").removeClass("hover")}),$(".csh-ch-bk .f_input").on("change",function(){$(".inp-fl-bt").addClass("check").html("заменить")}),$('input[name="cash"]').on("change",function(){var e=$(this).attr("id");$("#csh-ch-txt").hide(),$(".csh-ch-bk .form").hide(),$(".csh-ch-bk ."+e).show(),$('form[name="profile"] input[name="'+e+'"][disabled]').length?($(".csh-ch-bk ."+e+" form").html($('form[name="profile"] input[name="'+e+'"]').addClass("m_input").parent().clone().removeClass().addClass("focus inp-bk")),$("#cash-output-popup .csh-ch-bk .form.f-sub").show()):$(".csh-ch-bk ."+e+" form").html($("#cash-output-popup .txt-set-number.hidden").clone().removeClass("hidden"))}),$("input").keydown(function(e){if("number"==$(this).attr("data-type")){if(-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39)return;(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}else if("phone"==$(this).attr("data-type")){if(-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39)return;(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&61!=e.keyCode&&107!=e.keyCode&&e.preventDefault()}}),$("#terms-bt").on("click",function(){$("#terms").fadeIn(200)}),$("body").show(),window.setTimeout(function(){o=!Boolean($("img#ad:visible").length)},5e3),page){var m=$("nav.top-nav").offset().top;$(document).scrollTop()>m?$("nav.top-nav").addClass("fixed"):$("nav.top-nav").removeClass("fixed"),$(document).on("scroll",function(){$(document).scrollTop()>m?$("nav.top-nav").addClass("fixed"):$("nav.top-nav").removeClass("fixed")})}else{$("#logo-gotop").on("click",function(){$("html, body").animate({scrollTop:0},900,"easeInOutQuint")}),$(".tn-mbk_li, .scrollto, #exchange, .ticket-favorite .after i").on("click",function(){var e=$(this).attr("data-href");if("logout"==e)return!1;var t=$("."+e).offset().top-65;"tickets"==e&&(t=0),$("html, body").animate({scrollTop:t},900,"easeInOutQuint")});var m=$("nav.top-nav").offset().top,h=$(".tickets").offset().top,b=$(".prizes").offset().top,v=$(".reviews").offset().top,k=$(".rules").offset().top,g=$(".profile").offset().top,y=$(".chance").offset().top;$(document).scrollTop()>=0&&$(document).scrollTop()<b-300?($(".tn-mbk_li").removeClass("now"),$("#tickets-but").addClass("now")):$(document).scrollTop()>b-300&&$(document).scrollTop()<v-300?($(".tn-mbk_li").removeClass("now"),$("#prizes-but").addClass("now")):$(document).scrollTop()>v-300&&$(document).scrollTop()<k-300?($(".tn-mbk_li").removeClass("now"),$("#reviews-but").addClass("now")):$(document).scrollTop()>k-300&&$(document).scrollTop()<g-300?($(".tn-mbk_li").removeClass("now"),$("#rules-but").addClass("now")):$(document).scrollTop()>g-300&&$(document).scrollTop()<y-300?($(".tn-mbk_li").removeClass("now"),$("#profile-but").addClass("now")):$(document).scrollTop()>y-300&&($(".tn-mbk_li").removeClass("now"),$("#chance-but").addClass("now")),$(document).scrollTop()>m?$("nav.top-nav").addClass("fixed"):$("nav.top-nav").removeClass("fixed"),$(document).on("scroll",function(){h=$(".tickets").offset().top,b=$(".prizes").offset().top,v=$(".reviews").offset().top,k=$(".rules").offset().top,g=$(".profile").offset().top,y=$(".chance").offset().top,$(document).scrollTop()>=0&&$(document).scrollTop()<b-300?($(".tn-mbk_li").removeClass("now"),$("#tickets-but").addClass("now")):$(document).scrollTop()>b-300&&$(document).scrollTop()<v-300?($(".tn-mbk_li").removeClass("now"),$("#prizes-but").addClass("now")):$(document).scrollTop()>v-300&&$(document).scrollTop()<k-300?($(".tn-mbk_li").removeClass("now"),$("#reviews-but").addClass("now")):$(document).scrollTop()>k-300&&$(document).scrollTop()<g-300?($(".tn-mbk_li").removeClass("now"),$("#rules-but").addClass("now")):$(document).scrollTop()>g-300&&$(document).scrollTop()<y-300?($(".tn-mbk_li").removeClass("now"),$("#profile-but").addClass("now")):$(document).scrollTop()>y-300&&($(".tn-mbk_li").removeClass("now"),$("#chance-but").addClass("now")),$(document).scrollTop()>m?$("nav.top-nav").addClass("fixed"):$("nav.top-nav").removeClass("fixed")})}}),$(document).on("click","#qgame .start",function(){startQuickGame("QuickGame",null,buildQuickGame,function(e){$("#report-popup .cs").on("click",function(){location.reload()}),$("#report-popup").show().find(".txt").html(getText(e.message))},function(){alert("error")})}),$(function(){$(".slide-list").length&&$(".slide-list").each(function(){var e=$(this),t=e.find(".slide-wrap"),i=e.find(".next-slide"),n=e.find(".prev-slide"),a=e.find(".slide-item").outerWidth(),s=t.position().left-a;i.click(function(){t.is(":animated")||t.animate({left:s},500,function(){t.find(".slide-item:first").appendTo(t).parent().css({left:0})})}),n.click(function(){t.is(":animated")||t.css({left:s}).find(".slide-item:last").prependTo(t).parent().animate({left:0},500)})})}),$(".ch-gm-tbl .gm-bt").click(function(){hideAllGames(),$(".game-bk .play").show();var e=$(this).data("game"),t=$(this).data("quick");$("#ChanceGame-holder .qg-msg").hide(),$("#ChanceGame-holder .ul-hld").html($('.game-bk .gm-tb[data-game="'+e+'"]').last().clone().addClass("qg-tbl").show()),$('.game-bk .rw-b .tb[data-game="'+e+'"]').show(),55==e&&$('.game-bk .rw-b .tb[data-game="'+e+'"]').find(".td").removeClass("sel").first().addClass("sel"),$(".game-bk .l-bk-txt.qg-txt").html($(".game-bk").find("#game-rules").find('div[data-game="'+e+'"]').html()),$(".game-bk .l-bk-txt.qg-prz").html($(".game-bk").find("#game-prizes").find('div[data-game="'+e+'"]').html()),$(".game-bk").find(".gm-if-bk .l").html($(this).parent().find(".gm-if-bk .l").html()),$(".game-bk").find(".gm-if-bk .r").html($(this).parent().find(".gm-if-bk .r").html()),$(".ch-bk").fadeOut(200),window.setTimeout(function(){$(".game-bk").fadeIn(200)},200),$(".game-bk .play .bt").off("click").on("click",function(){var i=$(this);if(t)i.parents(".play").hide(),startQuickGame("ChanceGame",e,function(e){updatePoints(playerPoints-parseInt($(".game-bk").find(".gm-if-bk .r b").text())),buildQuickGame(e)},function(e){i.parents(".play").show(),$(".pz-ifo-bk").hide(),$(".pz-rt-bk").text(getText(e.message)).show().parents("#shop-items-popup").show()},function(){alert("error")});else{winChance=!1;var i=$(this);startChanceGame(e,function(){updatePoints(playerPoints-parseInt($(".game-bk").find(".gm-if-bk .r b").text())),i.parents(".play").hide()},function(){},function(){})}})}),$(document).on("click",".quickgame .qg-msg .bt",function(){var e=$(this);startQuickGame(e.attr("data-key"),e.attr("data-game"),function(e){updatePoints(playerPoints-parseInt($(".game-bk").find(".gm-if-bk .r b").text())),buildQuickGame(e)},function(t){e.parents(".quickgame").find(".play").show(),$(".pz-ifo-bk").hide(),$(".pz-rt-bk").text(getText(t.message)).show().parents("#shop-items-popup").show()},function(){alert("error")})}),$(document).on("click","li[data-coord]",function(){var e=$(this);playChanceGame($(this).parent().data("game"),$(this).data("coord"),function(t){if("win"==t.res.status)winChance=!0,$(".msg-tb.won").show(),$(".msg-tb.won").find(".pz-ph img").attr("src","/filestorage/shop/"+t.res.prize.image),$(".msg-tb.won").find(".tl b").text(t.res.prize.title),$(".msg-tb.won").find(".bt").off("click").on("click",function(){currentShowedItem=t.res.prize.id,$(".pz-ifo-bk").hide(),$(".pz-fm-bk").show(),$(".pz-rt-bk").hide(),$("#shop-items-popup").show().addClass("chance"),$("#shop-items-popup").find(".cs").hide()});else if("loose"==t.res.status){for(var i in t.res.field)for(var n in t.res.field[i])1==t.res.field[i][n]&&$('li[data-coord="'+i+"x"+n+'"]').addClass("blink");var a=3,s=window.setInterval(function(){return 0==a?(window.clearInterval(s),void $(".msg-tb.los").show()):(a--,void $("li.blink").toggleClass("true"))},600);$(".msg-tb.los").find(".bt span").text(e.parents(".gm-tb").data("price")),$(".msg-tb.los").find(".bt").off("click").on("click",function(){var t=$(this);startChanceGame(e.parent().data("game"),function(){t.parents(".msg-tb").hide(),updatePoints(playerPoints-parseInt($(".game-bk").find(".gm-if-bk .r b").text())),$("li[data-coord]").removeClass("won").removeClass("los"),$("li[data-coord]").removeClass("true").removeClass("blink"),$(".game-bk .rw-b .tb:visible").find(".td").removeClass("sel").first().addClass("sel")},function(e){$(".pz-ifo-bk").hide(),$(".pz-rt-bk").text(getText(e.message)).show().parents("#shop-items-popup").show()},function(){})})}else"process"==t.res.status&&0==t.res.cell&&(t.res.dublicate||$(".rw-b").find(".tb:visible").find(".td.sel").removeClass("sel").next().addClass("sel"));e.addClass(1==t.res.cell?"won":"los")},function(){},function(){})}),$(".game-bk .bk-bt").on("click",function(){$(".game-bk").fadeOut(200),window.setTimeout(function(){$(".ch-bk").fadeIn(200)},200)}),$('.p-cnt aside .ul_li[data-link="profile-notice"]').on("click",function(){var e=$(".profile-notice .notices .n-items");getNotices(0,function(t){if(t.res.length){var i="",n=0;$(t.res).each(function(e,t){n+=t.unread,i+='<div class="n-item'+(t.unread?"":" read")+'"><div class="n-i-tl"><div class="n-i-dt">'+t.date+' • </div><div class="n-i-ttl">'+t.title+'</div></div><div class="n-i-txt">'+t.text+"</div></div>"}),updateNotices(n),e.html($(i))}},function(){},function(){}),setTimeout(function(){$(".notice-unread").fadeOut(200),$(".n-item:not(.read)").addClass("read")},4500)}),$(".st-hy-bt").on("click",function(){$("#ta-his-popup").fadeIn(200),$("div.bblock").each(function(){var e=$(this).data("currency"),t=$(this);getTransactions(0,e,function(e){if(e.res.length){var i="";$(e.res).each(function(e,t){i+='<div class="rw"><div class="nm td"><span>'+t.description+'</span></div><div class="if td">'+t.quantity+'</div><div class="dt td"><span>'+t.date.replace(" ",'<br><span class="tm">')+"</span></div></div>"}),t.find(".tb").html($(i))}},function(){},function(){})}),$("#ta-his-popup").find(".cl").click(),$("#ta-his-popup").find(".pz-more-bt, .mr").off("click").on("click",function(){var e=$(this).parents(".bblock").data("currency");button=$(this),getTransactions($(this).parents(".bblock").find(".rw").length,e,function(e){if(e.res.length){var t="";$(e.res).each(function(e,i){t+='<div class="rw"><div class="nm td"><span>'+i.description+'</span></div><div class="if td">'+i.quantity+'</div><div class="dt td"><span>'+i.date.replace(" ",'<br><span class="tm">')+"</span></div></div>"}),button.parents(".bblock").find(".tb").append($(t)),button.hasClass("pz-more-bt")&&button.hide(),button.parents(".bblock").find(".mr-cl-bt-bl").show(),e.res.length<6&&button.parents(".bblock").find(".mr-cl-bt-bl").find(".mr").hide()}},function(){},function(){})}),$("#ta-his-popup").find(".cl").on("click",function(){$(this).parents(".bblock").find(".tb").find(".rw").each(function(e,t){e>5&&$(t).remove()}),$(this).parents(".bblock").find(".mr-cl-bt-bl").hide(),$(this).parents(".bblock").find(".pz-more-bt").show()})}),$(".fb-share").on("click",function(){fbPost(posts.fb)}),$(".vk-share").on("click",function(){vkPost(posts.vk)}),Object.size=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},String.prototype.replaceArray=function(e,t){for(var i,n=this,a=t,s=e,o=0;o<e.length&&($.isArray(e)&&(s=e[o]),i=new RegExp(s,"g"),$.isArray(t)&&(a=t[o]),n=n.replace(i,a),$.isArray(e));o++);return n};